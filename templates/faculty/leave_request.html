{% extends '../base.html' %}
{% load static %}
{% load faculty_filters %}

{% block nav-content %}

	<li class="nav-item" role="presentation">
		<a class="nav-link pr-3" href="{% url 'request_leave' %}" style="color: white;">Leave</a>
	</li>

{% endblock %}

{% block content %}
	<main>
		<input id="page_loaded" value="request_leave" style="display: none;">

		<div class="row m-3">
			<div class="col-sm-12 col-md-12">
					{% if leave %}
		<div class="d-flex justify-content-center mb-3">
			<div class="card col-md-10 border shadow" style="padding: 0;">

				<div class="card-header">
					<h4 class="card-title text-center font-weight-bold">Leave Details</h4>
						<p class="h6 text-center"><b>{{ leave.leave_type }}</b></p>
					<div class="row">
						<div class="col-md m-3 p-3">
							<p class="card-text h6"><b class="font-weight-bold">From: </b>{{ leave.leave_start_date }}</p>
							<p class="card-text h6"><b class="font-weight-bold">Start Time: </b>{{ leave.leave_start_time|time:'H:i' }}</p>
						</div>
						<div class="col-md m-3 p-3">
							<p class="card-text h6"><b class="font-weight-bold">To: </b>{{ leave.leave_end_date }}</p>
							<p class="card-text h6"><b class="font-weight-bold">End Time: </b>{{ leave.leave_end_time|time:'H:i' }}</p>
						</div>
					</div>
					{% if leave.supporting_file %}
					<a href="{{ leave.supporting_file.url }}" target="__blank">
								<p class="card-text text-center h6"><b class="font-weight-bold">Supporting File : </b><span class="text-info">
								{% with leave.supporting_file.name|split:"/" as fname %}
									{{ fname|last }}{% endwith %}</span></p>
							</a>
					{% endif %}
				</div>
				<form method="POST" action="{% url 'loadshifts' %}" enctype="multipart/form-data">
					{% csrf_token %}
					<div class="card-body text-center">
						<input type="hidden" name="leave_id" value="{{ leave.id }}">
						{% if adjust_opts %}
							<h5 class="card-title">Load Shifts</h5>
							{% for lec, adjs in adjust_opts.items %}
								<div class="card border mt-3">
									<div class="card-header font-weight-bold">
										{{ lec.0.lname.sname }}  on {{ lec.1|date }} at {{ lec.0.lec_time }}
									</div>
									<!-- <h6 class="card-title mt-2">{{ lec.lname.sname }}</h6> -->
								<input type="hidden" name="lecture_id" value="{{ lec.0.id }}">
								<!-- <select class="btn btn-dark dropdown-toggle" id="teachers_option" name="faculty_id"> -->
									{% if adjs %}
									{% for faculty in adjs %}
										<!-- <option value="{{ faculty.id }}">{{ faculty.username }}</option> -->
										<div class="row m-0 mt-0 mb-0 px-auto">
											<input class="checkbox-btn" name="{{ lec.0.id }}" type="checkbox" value="{{ faculty.id }}">
											<label class="checkbox-label" for="{{ faculty.id }}">
												<span>
													{{ faculty.username }}
												</span>
											</label>
										</div>
									{% endfor %}
									{% else %}
									<p class="text-danger h6 font-weight-bold m-1">Unavailable, will be compensated later.</p>
									{% endif %}
									</div>
								<!-- </select> -->
							{% endfor %}
							{% endif %}
							</div>
							<div class="card-footer text-center">
						<button type="submit" name="_cancel" class="btn btn-danger" id="option_submit">Cancel</button>
						<button type="submit" name="_apply" class="btn btn-info" id="option_submit">Apply</button>
					</div>
								</div>

					{% elif success %}
					<div class="d-flex justify-content-center">
							<div class="badge badge-success badge-lg col-md-6" style="font-size: 1.5rem;">Your leave has been submitted.</div>
					</div>
					{% else %}
				<div class="container shadow rounded">
					<form method="POST" action="{% url 'submit_leave' %}" enctype="multipart/form-data">
						{% csrf_token %}
						<div class="text-center">
							<p class="d-block font-weight-bold mb-3 mt-4 ml-2 pt-3 text-dark pb-4 h5 text-uppercase text-underline">Request Leave</p>
						</div>

						<div class="row">
							<div class="col-md-6">
								<small class="d-block font-weight-bold mb-1 ml-2 pl-3 text-dark h6 text-uppercase">Start Date</small>
								<div class="form-group pl-3">
									<div class="input-group input-group-alternative">
										<div class="input-group-prepend">
											<span class="input-group-text"><i class="ni ni-calendar-grid-58"></i></span>
										</div>
										<input type="text" class="form-control datepicker text-dark" data-provide="datepicker"
										data-date-format="mm/dd/yyyy" autocomplete="off" name="leave_start_date" data-date-start-date="0d">
									</div>
								</div>
							</div>
							<div class="col-md-6">
								<small class="d-block font-weight-bold mb-1 ml-2 pl-3 text-dark h6 text-uppercase">End Date</small>
								<div class="form-group pl-3 pr-3">
									<div class="input-group input-group-alternative">
										<div class="input-group-prepend">
											<span class="input-group-text"><i class="ni ni-calendar-grid-58"></i></span>
										</div>
										<input type="text" class="form-control datepicker text-dark" data-provide="datepicker"
										data-date-format="mm/dd/yyyy" autocomplete="off" name="leave_end_date" data-date-start-date="0d">
									</div>
								</div>
							</div>
						</div>
						<div class="row mt-4">
							<div class="col-md-6">
								<div class="form-group pl-3">
									<small class="d-block font-weight-bold mb-1 ml-2 text-dark h6 text-uppercase">Duration</small>
									<select class="form-control form-control-alternative pl-3" name="duration" required>
										<option value="-1" disabled selected>Duration</option>
										<option value="full">Full Day</option>
										<option value="first_half">First half</option>
										<option value="second_half">Second half</option>
									</select>
								</div>
							</div>
							<div class="col-md-6">
								<div class="form-group pl-3 pr-3">
									<small class="d-block font-weight-bold mb-1 ml-2 text-dark h6 text-uppercase">Leave Type</small>
									<select class="form-control form-control-alternative pl-3" name="leave_type" required>
										<option value="-1" disabled selected>Please Select</option>
										{% for leave_type in leave_types %}
										<option value="{{ leave_type.id }}">{{ leave_type }}</option>
										{% endfor %}
									</select>
								</div>
							</div>
						</div>
						<div class="row mt-4 text-center">
							<div class="col-md-6 mx-auto">
								<small class="d-block font-weight-bold mb-1 ml-2 pl-3 text-dark h6 text-uppercase">Attach certifcate or letter</small>
								<div class="form-group pt-1 pl-5 pr-5 text-center">
									<input class="form-control form-control-alternative text-center" type="file" name="supporting_file" disabled>
								</div>
							</div>
						</div>

						<div class="row m-3 mb-4 pb-4">
							<div class="col-md-12 d-flex justify-content-center align-items">
								<button type="submit" class="btn btn-primary">Submit</button>
							</div>
						</div>

					</form>
				</div>
						{% endif %}

	</main>
	<script>
		$(() => {
			$(".checkbox-label").click((e) => {
				if($(e.currentTarget).siblings('input')[0].checked){
					$(e.currentTarget).siblings('input')[0].checked=  false
				} else  {
					$(e.currentTarget).siblings('input')[0].checked = true
				}
			});
		});
		$('[name=leave_type]').change(function(){
			$('[name=supporting_file]').prop("disabled",true);
			if ($(this).val() == '3') {
				$('[name=supporting_file]').prop("disabled",false);
			}
		});
	</script>

{% endblock %}